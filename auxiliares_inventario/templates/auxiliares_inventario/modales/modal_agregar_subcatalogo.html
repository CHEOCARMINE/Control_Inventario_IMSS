<div class="modal-header">
  <h5 class="modal-title">Agregar Subcategor√≠a</h5>
  <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body">
  <form id="form-subcatalogo" method="post" action="{% url 'subcatalogo_create' %}">
    <div id="subcatalogo-form-fields">
      {% include 'auxiliares_inventario/modales/fragmento_form_subcatalogo.html' %}
    </div>
    <div class="text-right mt-3">
      <button type="submit" class="btn btn-primary">Guardar</button>
    </div>
  </form>
</div>
<script>
function bindFormSubcatalogo() {
  $('#form-subcatalogo')
    .off('submit')
    .on('submit', function(e) {
      e.preventDefault();
      const form = $(this);
      $.ajax({
        type: 'POST',
        url: form.attr('action'),
        data: form.serialize(),
        headers: { 'X-Requested-With': 'XMLHttpRequest' },
        success(res) {
          if (res.success) {
            $('#modal').modal('hide');
            window.location = res.redirect_url;
          } else {
            // Reemplazo TOTAL del modal, no solo los campos
            $('#modal .modal-content').html(res.html_form);
          }
        },
        error() {
          alert('Error de red. Intenta de nuevo.');
        }
      });
    });
}
bindFormSubcatalogo();
</script>

